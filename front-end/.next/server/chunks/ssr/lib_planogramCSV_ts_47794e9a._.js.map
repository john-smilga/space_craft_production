{"version":3,"sources":["../../../../lib/planogramCSV.ts"],"sourcesContent":["import { z } from 'zod';\nimport { schemas } from '@/lib/generated/api-schemas';\nimport type { GridResponse } from '@/features/planogram/types';\n\ntype PlanogramType = z.infer<typeof schemas.Planogram>;\n\nexport function generatePlanogramCSV(planogram: PlanogramType | null | undefined, layout: GridResponse | null): string {\n  if (!planogram) {\n    return 'No planogram data available';\n  }\n\n  const rows: string[] = [];\n\n  // Header row\n  rows.push('Planogram Name,Project,Season,Categories,Display,Dimensions (W×H×D),Shelves,Shelf Spacing');\n\n  // Metadata row\n  const categories = Array.isArray(planogram.categories) \n    ? (planogram.categories as Array<{ name: string }>).map((c) => c.name).join('; ') \n    : 'N/A';\n  const displayName = planogram.display_name || 'N/A';\n  // Get dimensions from planogram (they're at the top level)\n  const widthIn = planogram.width_in;\n  const heightIn = planogram.height_in;\n  const depthIn = planogram.depth_in;\n  const dimensions = widthIn && heightIn ? `${widthIn}\"×${heightIn}\"${depthIn ? `×${depthIn}\"` : ''}` : 'N/A';\n\n  const projectName = planogram.project_name || 'Unknown';\n  const seasonDisplay = planogram.season || 'N/A';\n  const shelfCount = planogram.shelf_count ?? 'N/A';\n  const shelfSpacing = planogram.shelf_spacing?.toString() || 'N/A';\n  rows.push([`\"${planogram.name.replace(/\"/g, '\"\"')}\"`, `\"${projectName.replace(/\"/g, '\"\"')}\"`, seasonDisplay, `\"${categories.replace(/\"/g, '\"\"')}\"`, `\"${displayName.replace(/\"/g, '\"\"')}\"`, dimensions, shelfCount.toString(), shelfSpacing].join(','));\n\n  // Empty row\n  rows.push('');\n\n  // Products table header\n  rows.push('Row/Shelf,Product Name,Category,Position X,Position Y,Width,Height,Score');\n\n  // Products data\n  if (layout && layout.rows.length > 0) {\n    layout.rows.forEach((row) => {\n      row.items.forEach((item) => {\n        const score = item.meta?.score != null ? item.meta.score.toString() : 'N/A';\n        rows.push([`\"${row.name.replace(/\"/g, '\"\"')}\"`, `\"${item.meta.name.replace(/\"/g, '\"\"')}\"`, `\"${(item.meta.category || 'N/A').replace(/\"/g, '\"\"')}\"`, item.x.toString(), item.y.toString(), item.w.toString(), item.h.toString(), score].join(','));\n      });\n    });\n  }\n\n  return rows.join('\\n');\n}\n"],"names":[],"mappings":"uCAMO,SAAS,EAAqB,CAA2C,CAAE,CAA2B,EAC3G,GAAI,CAAC,EACH,MAAO,GADO,2BAIhB,IAAM,EAAiB,EAAE,CAGzB,EAAK,IAAI,CAAC,6FAGV,IAAM,EAAa,MAAM,OAAO,CAAC,EAAU,UAAU,EAChD,EAAU,UAAU,CAA6B,GAAG,CAAC,AAAC,GAAM,EAAE,IAAI,EAAE,IAAI,CAAC,MAC1E,MACE,EAAc,EAAU,YAAY,EAAI,MAExC,EAAU,EAAU,QAAQ,CAC5B,EAAW,EAAU,SAAS,CAC9B,EAAU,EAAU,QAAQ,CAC5B,EAAa,GAAW,EAAW,CAAA,EAAG,EAAQ,KAAE,EAAE,EAAS,CAAC,EAAE,EAAU,CAAC,IAAC,EAAE,EAAQ,CAAC,CAAC,CAAG,GAAA,CAAI,CAAG,MAEhG,EAAc,EAAU,YAAY,EAAI,UACxC,EAAgB,EAAU,MAAM,EAAI,MACpC,EAAa,EAAU,WAAW,EAAI,MACtC,EAAe,EAAU,aAAa,EAAE,YAAc,MAmB5D,OAlBA,EAAK,IAAI,CAAC,CAAC,CAAC,CAAC,EAAE,EAAU,IAAI,CAAC,OAAO,CAAC,KAAM,MAAM,CAAC,CAAC,CAAE,CAAC,CAAC,EAAE,EAAY,OAAO,CAAC,KAAM,MAAM,CAAC,CAAC,CAAE,EAAe,CAAC,CAAC,EAAE,EAAW,OAAO,CAAC,KAAM,MAAM,CAAC,CAAC,CAAE,CAAC,CAAC,EAAE,EAAY,OAAO,CAAC,KAAM,MAAM,CAAC,CAAC,CAAE,EAAY,EAAW,QAAQ,GAAI,EAAa,CAAC,IAAI,CAAC,MAGlP,EAAK,IAAI,CAAC,IAGV,EAAK,IAAI,CAAC,4EAGN,GAAU,EAAO,IAAI,CAAC,MAAM,CAAG,GAAG,AACpC,EAAO,IAAI,CAAC,OAAO,CAAC,AAAC,IACnB,EAAI,KAAK,CAAC,OAAO,CAAC,AAAC,IACjB,IAAM,EAAQ,EAAK,IAAI,EAAE,OAAS,KAAO,EAAK,IAAI,CAAC,KAAK,CAAC,QAAQ,GAAK,MACtE,EAAK,IAAI,CAAC,CAAC,CAAC,CAAC,EAAE,EAAI,IAAI,CAAC,OAAO,CAAC,KAAM,MAAM,CAAC,CAAC,CAAE,CAAC,CAAC,EAAE,EAAK,IAAI,CAAC,IAAI,CAAC,OAAO,CAAC,KAAM,MAAM,CAAC,CAAC,CAAE,CAAC,CAAC,EAAE,CAAC,EAAK,IAAI,CAAC,QAAQ,EAAI,KAAA,CAAK,CAAE,OAAO,CAAC,KAAM,MAAM,CAAC,CAAC,CAAE,EAAK,CAAC,CAAC,QAAQ,GAAI,EAAK,CAAC,CAAC,QAAQ,GAAI,EAAK,CAAC,CAAC,QAAQ,GAAI,EAAK,CAAC,CAAC,QAAQ,GAAI,EAAM,CAAC,IAAI,CAAC,KAC/O,EACF,GAGK,EAAK,IAAI,CAAC,KACnB"}