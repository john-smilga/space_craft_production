{"version":3,"sources":["../../../../features/auth/store/auth-slice.ts","../../../../features/auth/queries/use-current-user-query.ts","../../../../features/auth/queries/use-login-mutation.ts","../../../../features/auth/queries/use-logout-mutation.ts","../../../../features/auth/queries/use-register-mutation.ts","../../../../features/auth/queries/use-update-username-mutation.ts","../../../../features/auth/hooks/use-is-admin.ts","../../../../features/auth/hooks/use-require-admin.ts","../../../../app/login/components/LoginForm.tsx"],"sourcesContent":["import { create } from 'zustand';\nimport { devtools } from 'zustand/middleware';\nimport { z } from 'zod';\nimport { createSelectors } from '@/lib/zustand/create-selectors';\nimport { schemas } from '@/lib/generated/api-schemas';\n\ntype UserType = z.infer<typeof schemas.User>;\n\ninterface AuthState {\n  user: UserType | null;\n  setUser: (user: UserType | null) => void;\n  clearUser: () => void;\n}\n\nconst useAuthStoreBase = create<AuthState>()(\n  devtools(\n    (set) => ({\n      user: null,\n      setUser: (user) => set({ user }, false, 'setUser'),\n      clearUser: () => set({ user: null }, false, 'clearUser'),\n    }),\n    { name: 'AuthStore' }\n  )\n);\n\nexport const useAuthStore = createSelectors(useAuthStoreBase);\n\n","'use client';\nimport { useQuery } from '@tanstack/react-query'\nimport { z } from 'zod'\nimport api from '@/lib/axios'\nimport { schemas } from '@/lib/generated/api-schemas'\nimport { useAuthStore } from '../store'\n\ntype UserType = z.infer<typeof schemas.User>\n\nasync function fetchCurrentUser(): Promise<UserType> {\n  const { data } = await api.get('/users/me/')\n  return schemas.User.parse(data)\n}\n\nexport function useCurrentUserQuery() {\n  const user = useAuthStore.use.user()\n  const setUser = useAuthStore.use.setUser()\n\n  return useQuery({\n    queryKey: ['auth', 'current-user'],\n    queryFn: async () => {\n      try {\n        const fetchedUser = await fetchCurrentUser()\n        setUser(fetchedUser)\n        return fetchedUser\n      } catch (error) {\n        setUser(null)\n        throw error\n      }\n    },\n    enabled: !user,\n    retry: false,\n    staleTime: Infinity,\n  })\n}\n","'use client';\nimport { useQueryClient } from '@tanstack/react-query';\nimport { z } from 'zod';\nimport api from '@/lib/axios';\nimport { useAppMutation } from '@/lib/react-query/hooks';\nimport { schemas } from '@/lib/generated/api-schemas';\nimport { useAuthStore } from '../store';\n\ntype LoginCredentials = z.infer<typeof schemas.LoginRequest>;\ntype LoginResponse = z.infer<typeof schemas.User>;\n\nexport function useLoginMutation() {\n  const queryClient = useQueryClient();\n  const setUser = useAuthStore.use.setUser();\n\n  return useAppMutation<LoginResponse, LoginCredentials>(\n    async (credentials) => {\n      const validatedInput = schemas.LoginRequest.parse(credentials);\n      const { data } = await api.post('/auth/login/', validatedInput);\n      return schemas.User.parse(data);\n    },\n    {\n      successMessage: 'Logged in successfully',\n      errorMessage: 'Login failed',\n      onSuccess: (data) => {\n        setUser(data);\n        queryClient.setQueryData(['auth', 'current-user'], data);\n      },\n    }\n  );\n}\n\n","'use client';\nimport { useQueryClient } from '@tanstack/react-query';\nimport api from '@/lib/axios';\nimport { useAppMutation } from '@/lib/react-query/hooks';\nimport { useAuthStore } from '../store';\n\nexport function useLogoutMutation() {\n  const queryClient = useQueryClient();\n  const clearUser = useAuthStore.use.clearUser();\n\n  return useAppMutation<void, void>(\n    async () => {\n      await api.post('/auth/logout/');\n    },\n    {\n      successMessage: 'Logged out successfully',\n      errorMessage: 'Logout failed',\n      onSuccess: () => {\n        clearUser();\n        queryClient.setQueryData(['auth', 'current-user'], null);\n        queryClient.clear();\n      },\n    }\n  );\n}\n\n","'use client';\nimport { useQueryClient } from '@tanstack/react-query';\nimport { z } from 'zod';\nimport api from '@/lib/axios';\nimport { useAppMutation } from '@/lib/react-query/hooks';\nimport { schemas } from '@/lib/generated/api-schemas';\nimport { useAuthStore } from '../store';\n\ntype RegisterData = z.infer<typeof schemas.RegisterRequestRequest>;\ntype RegisterResponse = z.infer<typeof schemas.User>;\n\nexport function useRegisterMutation() {\n  const queryClient = useQueryClient();\n  const setUser = useAuthStore.use.setUser();\n\n  return useAppMutation<RegisterResponse, RegisterData>(\n    async (data) => {\n      const validatedInput = schemas.RegisterRequestRequest.parse(data);\n      const response = await api.post('/auth/register/', validatedInput);\n      return schemas.User.parse(response.data);\n    },\n    {\n      successMessage: 'Registered successfully',\n      errorMessage: 'Registration failed',\n      onSuccess: (data) => {\n        setUser(data);\n        queryClient.setQueryData(['auth', 'current-user'], data);\n      },\n    }\n  );\n}\n\n","'use client';\nimport { z } from 'zod';\nimport api from '@/lib/axios';\nimport { useAppMutation } from '@/lib/react-query/hooks';\nimport { schemas } from '@/lib/generated/api-schemas';\n\ntype UpdateUsernameInput = z.infer<typeof schemas.PatchedUserRequest>;\ntype UserResponse = z.infer<typeof schemas.User>;\n\nexport function useUpdateUsernameMutation() {\n  return useAppMutation<UserResponse, UpdateUsernameInput>(\n    async (input) => {\n      const validatedInput = schemas.PatchedUserRequest.parse(input);\n      const response = await api.patch('/users/me/username/', validatedInput);\n      return schemas.User.parse(response.data);\n    },\n    {\n      successMessage: 'Username updated successfully',\n      errorMessage: 'Failed to update username',\n      invalidateQueries: [['current-user']],\n    }\n  );\n}\n\n","'use client';\nimport { useAuthStore } from '../store';\n\nexport function useIsAdmin(): boolean {\n  const user = useAuthStore.use.user();\n  return user?.role === 'admin' || false;\n}\n\n","'use client';\nimport { useEffect } from 'react';\nimport { useRouter } from 'next/navigation';\nimport { useIsAdmin } from './use-is-admin';\nimport { useAuthStore } from '../store';\n\nexport function useRequireAdmin(): void {\n  const router = useRouter();\n  const isAdmin = useIsAdmin();\n  const user = useAuthStore.use.user();\n\n  useEffect(() => {\n    if (user && !isAdmin) {\n      router.push('/dashboard');\n    }\n  }, [user, isAdmin, router]);\n}\n\n","'use client';\n\nimport { useState } from 'react';\nimport { useRouter } from 'next/navigation';\nimport { useLoginMutation } from '@/features/auth';\nimport { Button } from '@/components/ui/button';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { FormField } from '@/components/ui/form-field';\nimport { FormSelectField } from '@/components/ui/form-select-field';\n\nconst DEMO_USERS = [\n  { label: 'Publix Admin', value: 'publix', email: 'admin_publix@publix.com', password: 'admin123' },\n  { label: 'Walmart Admin', value: 'walmart', email: 'admin_walmart@walmart.com', password: 'admin123' },\n];\n\nexport default function LoginForm() {\n  const [email, setEmail] = useState('');\n  const [password, setPassword] = useState('');\n  const [demoUser, setDemoUser] = useState('');\n  const [error, setError] = useState<string | null>(null);\n  const loginMutation = useLoginMutation();\n  const router = useRouter();\n\n  const handleDemoUserChange = (value: string) => {\n    setDemoUser(value);\n    if (value) {\n      const user = DEMO_USERS.find((u) => u.value === value);\n      if (user) {\n        setEmail(user.email);\n        setPassword(user.password);\n      }\n    } else {\n      setEmail('');\n      setPassword('');\n    }\n  };\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n    setError(null);\n    try {\n      await loginMutation.mutateAsync({ email, password });\n      router.push('/dashboard');\n    } catch (error: unknown) {\n      if (error instanceof Error) {\n        setError(error.message || 'Login failed');\n      } else {\n        setError('Login failed');\n      }\n    }\n  };\n\n  return (\n    <Card className='w-full max-w-md mx-auto'>\n      <CardHeader>\n        <CardTitle className='text-2xl text-center'>Login</CardTitle>\n      </CardHeader>\n      <CardContent>\n        <form onSubmit={handleSubmit} className='space-y-4'>\n          <FormSelectField\n            label='Demo User'\n            value={demoUser}\n            onValueChange={handleDemoUserChange}\n            options={DEMO_USERS.map((user) => ({ label: user.label, value: user.value }))}\n            placeholder='Select a demo user...'\n          />\n          <FormField\n            label='Email'\n            type='email'\n            placeholder='Email'\n            value={email}\n            onChange={(e) => setEmail(e.target.value)}\n            required\n          />\n          <FormField\n            label='Password'\n            type='password'\n            placeholder='Password'\n            value={password}\n            onChange={(e) => setPassword(e.target.value)}\n            required\n          />\n          {error && <p className='text-destructive text-sm'>{error}</p>}\n          <Button type='submit' disabled={loginMutation.isPending} className='w-full'>\n            {loginMutation.isPending ? 'Loading...' : 'Login'}\n          </Button>\n        </form>\n      </CardContent>\n    </Card>\n  );\n}\n"],"names":[],"mappings":"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"}